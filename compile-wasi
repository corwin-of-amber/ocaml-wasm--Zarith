
OCAML_SRC=${OCAML_SRC:=../ocaml}

CCSHARED="$WASI_SDK/bin/clang -target wasm32-unknown-emscripten -D__wasi__ -fPIC -Wl,--shared"
CCFLAGS="-Os -nostdlib -Wl,--export-all -include $WASIK_INC/etc.h -I $WASIK_INC -I $OCAML_SRC/runtime"

CCFLAGS="-Os -DHAS_GMP -I $OCAML_SRC/runtime"
LDFLAGS="-shared -Wl,-flat_namespace,-undefined,suppress"

mkdir -p bin

wasi-kit clang $CCFLAGS -c caml_z_stubs.c -o caml_z_stubs.o
wasi-kit clang $LDFLAGS caml_z_stubs.o -o dllzarith.so
